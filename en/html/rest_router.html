<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Router &mdash; Ryubook 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Ryubook 1.0 documentation" href="index.html" />
    <link rel="next" title="QoS" href="rest_qos.html" />
    <link rel="prev" title="Firewall" href="rest_firewall.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="rest_qos.html" title="QoS"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="rest_firewall.html" title="Firewall"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Ryubook 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="router">
<span id="ch-rest-router"></span><h1>Router<a class="headerlink" href="#router" title="Permalink to this headline">¶</a></h1>
<p>This section describes how to use a router that can be set using REST.</p>
<div class="section" id="example-of-the-operation-of-a-single-tenant">
<h2>Example of the Operation of a Single Tenant<a class="headerlink" href="#example-of-the-operation-of-a-single-tenant" title="Permalink to this headline">¶</a></h2>
<p>The following shows an example of creating topology such as the following and adding or deleting a route or address for each switch (router) and verifying communication availability between each host.</p>
<a class="reference internal image-reference" href="_images/fig15.png"><img alt="_images/fig15.png" class="align-center" src="_images/fig15.png" style="width: 400.0px; height: 246.8px;" /></a>
<div class="section" id="building-the-environment">
<h3>Building the environment<a class="headerlink" href="#building-the-environment" title="Permalink to this headline">¶</a></h3>
<p>First, build an environment on Mininet. Parameters of the <code class="docutils literal"><span class="pre">mn</span></code> command are as follows.</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="14%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Value</th>
<th class="head">Explanation</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>topo</td>
<td>linear,3</td>
<td>Topology where three switches are connected serially</td>
</tr>
<tr class="row-odd"><td>mac</td>
<td>None</td>
<td>Set the MAC address of the host automatically</td>
</tr>
<tr class="row-even"><td>switch</td>
<td>ovsk</td>
<td>Use Open vSwitch</td>
</tr>
<tr class="row-odd"><td>controller</td>
<td>remote</td>
<td>Use an external one for OpenFlow controller</td>
</tr>
<tr class="row-even"><td>x</td>
<td>None</td>
<td>Start xterm</td>
</tr>
</tbody>
</table>
<p>An execution example is as follows.</p>
<div class="console highlight-python"><div class="highlight"><pre>ryu@ryu-vm:~$ sudo mn --topo linear,3 --mac --switch ovsk --controller remote -x
*** Creating network
*** Adding controller
Unable to contact the remote controller at 127.0.0.1:6633
*** Adding hosts:
h1 h2 h3
*** Adding switches:
s1 s2 s3
*** Adding links:
(h1, s1) (h2, s2) (h3, s3) (s1, s2) (s2, s3)
*** Configuring hosts
h1 h2 h3
*** Running terms on localhost:10.0
*** Starting controller
*** Starting 3 switches
s1 s2 s3

*** Starting CLI:
mininet&gt;
</pre></div>
</div>
<p>Also, start another xterm for the controller.</p>
<div class="console highlight-python"><div class="highlight"><pre>mininet&gt; xterm c0
mininet&gt;
</pre></div>
</div>
<p>Next, set the version of OpenFlow to be used in each router to 1.3.</p>
<p>switch: s1 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ovs-vsctl set Bridge s1 protocols=OpenFlow13
</pre></div>
</div>
<p>switch: s2 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ovs-vsctl set Bridge s2 protocols=OpenFlow13
</pre></div>
</div>
<p>switch: s3 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ovs-vsctl set Bridge s3 protocols=OpenFlow13
</pre></div>
</div>
<p>Then, delete the IP address that is assigned automatically on each host and set a new IP address.</p>
<p>host: h1:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip addr del 10.0.0.1/8 dev h1-eth0
root@ryu-vm:~# ip addr add 172.16.20.10/24 dev h1-eth0
</pre></div>
</div>
<p>host: h2:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip addr del 10.0.0.2/8 dev h2-eth0
root@ryu-vm:~# ip addr add 172.16.10.10/24 dev h2-eth0
</pre></div>
</div>
<p>host: h3:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip addr del 10.0.0.3/8 dev h3-eth0
root@ryu-vm:~# ip addr add 192.168.30.10/24 dev h3-eth0
</pre></div>
</div>
<p>Finally, start rest_router on xterm of controller.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ryu-manager ryu.app.rest_router
loading app ryu.app.rest_router
loading app ryu.controller.ofp_handler
instantiating app None of DPSet
creating context dpset
creating context wsgi
instantiating app ryu.app.rest_router of RestRouterAPI
instantiating app ryu.controller.ofp_handler of OFPHandler
(2212) wsgi starting up on http://0.0.0.0:8080/
</pre></div>
</div>
<p>After a successful connection between the router and Ryu, the following message appears.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>[RT][INFO] switch_id=0000000000000003: Set SW config for TTL error packet in.
[RT][INFO] switch_id=0000000000000003: Set ARP handling (packet in) flow [cookie=0x0]
[RT][INFO] switch_id=0000000000000003: Set L2 switching (normal) flow [cookie=0x0]
[RT][INFO] switch_id=0000000000000003: Set default route (drop) flow [cookie=0x0]
[RT][INFO] switch_id=0000000000000003: Start cyclic routing table update.
[RT][INFO] switch_id=0000000000000003: Join as router.
...
</pre></div>
</div>
<p>If the above log is displayed for the three routers, preparation is complete.</p>
</div>
<div class="section" id="setting-the-address">
<h3>Setting the Address<a class="headerlink" href="#setting-the-address" title="Permalink to this headline">¶</a></h3>
<p>Set the address for each router.</p>
<p>First, set the addresses &#8220;172.16.20.1/24&#8221; and &#8220;172.16.30.30/24&#8221; for router s1.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For details of REST API used in the following description, see &#8220;<a class="reference internal" href="#rest-api-list">REST API List</a>&#8221; at the end of the section.</p>
</div>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;:&quot;172.16.20.1/24&quot;}&#39; http://localhost:8080/router/0000000000000001
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000001&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;details&quot;: &quot;Add address [address_id=1]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;172.16.30.30/24&quot;}&#39; http://localhost:8080/router/0000000000000001
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000001&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;details&quot;: &quot;Add address [address_id=2]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The result of the REST command is formatted for easy viewing.</p>
</div>
<p>Next, set the addresses &#8220;172.16.10.1/24&#8221;, &#8220;172.16.30.1/24&#8221; and &#8220;192.168.10.1/24&#8221; for router s2.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;:&quot;172.16.10.1/24&quot;}&#39; http://localhost:8080/router/0000000000000002
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000002&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;details&quot;: &quot;Add address [address_id=1]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;172.16.30.1/24&quot;}&#39; http://localhost:8080/router/0000000000000002
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000002&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;details&quot;: &quot;Add address [address_id=2]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;192.168.10.1/24&quot;}&#39; http://localhost:8080/router/0000000000000002
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000002&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;details&quot;: &quot;Add address [address_id=3]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<p>Then, set the addresses &#8220;192.168.30.1/24&#8221; and &#8220;192.168.10.20/24&#8221; for router s3.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;192.168.30.1/24&quot;}&#39; http://localhost:8080/router/0000000000000003
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000003&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;details&quot;: &quot;Add address [address_id=1]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;192.168.10.20/24&quot;}&#39; http://localhost:8080/router/0000000000000003
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000003&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;details&quot;: &quot;Add address [address_id=2]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<p>IP addresses to the router have been set. Register as the default gateway on each host.</p>
<p>host: h1:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip route add default via 172.16.20.1
</pre></div>
</div>
<p>host: h2:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip route add default via 172.16.10.1
</pre></div>
</div>
<p>host: h3:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip route add default via 192.168.30.1
</pre></div>
</div>
</div>
<div class="section" id="configuring-the-default-route">
<h3>Configuring the Default Route<a class="headerlink" href="#configuring-the-default-route" title="Permalink to this headline">¶</a></h3>
<p>Set the default route for each router.</p>
<p>First, set router s2 as the default route of router s1.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;gateway&quot;: &quot;172.16.30.1&quot;}&#39; http://localhost:8080/router/0000000000000001
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000001&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;details&quot;: &quot;Add route [route_id=1]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<p>Set router s1 as the default route of router s2.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;gateway&quot;: &quot;172.16.30.30&quot;}&#39; http://localhost:8080/router/0000000000000002
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000002&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;details&quot;: &quot;Add route [route_id=1]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<p>Set router s2 as the default route of router s3.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;gateway&quot;: &quot;192.168.10.1&quot;}&#39; http://localhost:8080/router/0000000000000003
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000003&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;details&quot;: &quot;Add route [route_id=1]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
</div>
<div class="section" id="setting-static-routes">
<h3>Setting Static Routes<a class="headerlink" href="#setting-static-routes" title="Permalink to this headline">¶</a></h3>
<p>For s2 router, set a static route to the host (192.168.30.0/24) under router s3.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;destination&quot;: &quot;192.168.30.0/24&quot;, &quot;gateway&quot;: &quot;192.168.10.20&quot;}&#39; http://localhost:8080/router/0000000000000002
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000002&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;details&quot;: &quot;Add route [route_id=2]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<p>The setting status of the route and address are as follows.</p>
<a class="reference internal image-reference" href="_images/fig41.png"><img alt="_images/fig41.png" class="align-center" src="_images/fig41.png" style="width: 400.0px; height: 288.0px;" /></a>
</div>
<div class="section" id="verifying-the-setting">
<h3>Verifying the Setting<a class="headerlink" href="#verifying-the-setting" title="Permalink to this headline">¶</a></h3>
<p>Check the contents of the setting of each router.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl http://localhost:8080/router/0000000000000001
  [
    {
      &quot;internal_network&quot;: [
        {
          &quot;route&quot;: [
            {
              &quot;route_id&quot;: 1,
              &quot;destination&quot;: &quot;0.0.0.0/0&quot;,
              &quot;gateway&quot;: &quot;172.16.30.1&quot;
            }
          ],
          &quot;address&quot;: [
            {
              &quot;address_id&quot;: 1,
              &quot;address&quot;: &quot;172.16.20.1/24&quot;
            },
            {
              &quot;address_id&quot;: 2,
              &quot;address&quot;: &quot;172.16.30.30/24&quot;
            }
          ]
        }
      ],
      &quot;switch_id&quot;: &quot;0000000000000001&quot;
    }
  ]

root@ryu-vm:~# curl http://localhost:8080/router/0000000000000002
  [
    {
      &quot;internal_network&quot;: [
        {
          &quot;route&quot;: [
            {
              &quot;route_id&quot;: 1,
              &quot;destination&quot;: &quot;0.0.0.0/0&quot;,
              &quot;gateway&quot;: &quot;172.16.30.30&quot;
            },
            {
              &quot;route_id&quot;: 2,
              &quot;destination&quot;: &quot;192.168.30.0/24&quot;,
              &quot;gateway&quot;: &quot;192.168.10.20&quot;
            }
          ],
          &quot;address&quot;: [
            {
              &quot;address_id&quot;: 2,
              &quot;address&quot;: &quot;172.16.30.1/24&quot;
            },
            {
              &quot;address_id&quot;: 3,
              &quot;address&quot;: &quot;192.168.10.1/24&quot;
            },
            {
              &quot;address_id&quot;: 1,
              &quot;address&quot;: &quot;172.16.10.1/24&quot;
            }
          ]
        }
      ],
      &quot;switch_id&quot;: &quot;0000000000000002&quot;
    }
  ]

root@ryu-vm:~# curl http://localhost:8080/router/0000000000000003
  [
    {
      &quot;internal_network&quot;: [
        {
          &quot;route&quot;: [
            {
              &quot;route_id&quot;: 1,
              &quot;destination&quot;: &quot;0.0.0.0/0&quot;,
              &quot;gateway&quot;: &quot;192.168.10.1&quot;
            }
          ],
          &quot;address&quot;: [
            {
              &quot;address_id&quot;: 1,
              &quot;address&quot;: &quot;192.168.30.1/24&quot;
            },
            {
              &quot;address_id&quot;: 2,
              &quot;address&quot;: &quot;192.168.10.20/24&quot;
            }
          ]
        }
      ],
      &quot;switch_id&quot;: &quot;0000000000000003&quot;
    }
  ]
</pre></div>
</div>
<p>Check communication using ping in this state. First, run a ping from h3 to h2. You can verify that it can communicate successfully.</p>
<p>host: h2:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ping 192.168.30.10
PING 192.168.30.10 (192.168.30.10) 56(84) bytes of data.
64 bytes from 192.168.30.10: icmp_req=1 ttl=62 time=48.8 ms
64 bytes from 192.168.30.10: icmp_req=2 ttl=62 time=0.402 ms
64 bytes from 192.168.30.10: icmp_req=3 ttl=62 time=0.089 ms
64 bytes from 192.168.30.10: icmp_req=4 ttl=62 time=0.065 ms
...
</pre></div>
</div>
<p>Next, run a ping from h2 to h1. You can also verify that it can communicate successfully.</p>
<p>host: h2:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ping 172.16.20.10
PING 172.16.20.10 (172.16.20.10) 56(84) bytes of data.
64 bytes from 172.16.20.10: icmp_req=1 ttl=62 time=43.2 ms
64 bytes from 172.16.20.10: icmp_req=2 ttl=62 time=0.306 ms
64 bytes from 172.16.20.10: icmp_req=3 ttl=62 time=0.057 ms
64 bytes from 172.16.20.10: icmp_req=4 ttl=62 time=0.048 ms
...
</pre></div>
</div>
</div>
<div class="section" id="deleting-the-static-route">
<h3>Deleting the Static Route<a class="headerlink" href="#deleting-the-static-route" title="Permalink to this headline">¶</a></h3>
<p>Delete the static route to router s3 set in router s2.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X DELETE -d &#39;{&quot;route_id&quot;: &quot;2&quot;}&#39; http://localhost:8080/router/0000000000000002
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000002&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;details&quot;: &quot;Delete route [route_id=2]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<p>Check the information that has been configured on router s2. You can see that the static route to router s3 has been deleted.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl http://localhost:8080/router/0000000000000002
  [
    {
      &quot;internal_network&quot;: [
        {
          &quot;route&quot;: [
            {
              &quot;route_id&quot;: 1,
              &quot;destination&quot;: &quot;0.0.0.0/0&quot;,
              &quot;gateway&quot;: &quot;172.16.30.30&quot;
            }
          ],
          &quot;address&quot;: [
            {
              &quot;address_id&quot;: 2,
              &quot;address&quot;: &quot;172.16.30.1/24&quot;
            },
            {
              &quot;address_id&quot;: 3,
              &quot;address&quot;: &quot;192.168.10.1/24&quot;
            },
            {
              &quot;address_id&quot;: 1,
              &quot;address&quot;: &quot;172.16.10.1/24&quot;
            }
          ]
        }
      ],
      &quot;switch_id&quot;: &quot;0000000000000002&quot;
    }
  ]
</pre></div>
</div>
<p>Check communication using ping. Since the root information from h3 to h2 was deleted, you will find that it cannot communicate.</p>
<p>host: h2:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ping 192.168.30.10
PING 192.168.30.10 (192.168.30.10) 56(84) bytes of data.
^C
--- 192.168.30.10 ping statistics ---
12 packets transmitted, 0 received, 100% packet loss, time 11088ms
</pre></div>
</div>
</div>
<div class="section" id="deleting-an-address">
<h3>Deleting an Address<a class="headerlink" href="#deleting-an-address" title="Permalink to this headline">¶</a></h3>
<p>Delete the address &#8220;172.16.20.1/24&#8221;, which is set in router s1.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X DELETE -d &#39;{&quot;address_id&quot;: &quot;1&quot;}&#39; http://localhost:8080/router/0000000000000001
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000001&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;details&quot;: &quot;Delete address [address_id=1]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<p>Check the information that has been configured on router s1. You can see that of the IP addresses configured on router s1, &#8220;172.16.20.1/24&#8221; has been deleted.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl http://localhost:8080/router/0000000000000001
  [
    {
      &quot;internal_network&quot;: [
        {
          &quot;route&quot;: [
            {
              &quot;route_id&quot;: 1,
              &quot;destination&quot;: &quot;0.0.0.0/0&quot;,
              &quot;gateway&quot;: &quot;172.16.30.1&quot;
            }
          ],
          &quot;address&quot;: [
            {
              &quot;address_id&quot;: 2,
              &quot;address&quot;: &quot;172.16.30.30/24&quot;
            }
          ]
        }
      ],
      &quot;switch_id&quot;: &quot;0000000000000001&quot;
    }
  ]
</pre></div>
</div>
<p>Check communication using ping. Since the information about the subnet to which h1 belongs has been removed from router s1, you can tell that communication from h2 to h1 is not possible.</p>
<p>host: h2:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ping 172.16.20.10
PING 172.16.20.10 (172.16.20.10) 56(84) bytes of data.
^C
--- 172.16.20.10 ping statistics ---
19 packets transmitted, 0 received, 100% packet loss, time 18004ms
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-of-the-operation-of-a-multi-tenant">
<h2>Example of the Operation of a Multi-tenant<a class="headerlink" href="#example-of-the-operation-of-a-multi-tenant" title="Permalink to this headline">¶</a></h2>
<p>The following shows an example of creating a topology where tenants are divided by VLAN such as the following and routes or addresses for each switch (router) are added or deleted and communication availability between each host is verified.</p>
<a class="reference internal image-reference" href="_images/fig51.png"><img alt="_images/fig51.png" class="align-center" src="_images/fig51.png" style="width: 498.0px; height: 318.4px;" /></a>
<div class="section" id="environment-building">
<h3>Environment building<a class="headerlink" href="#environment-building" title="Permalink to this headline">¶</a></h3>
<p>First, build an environment on Mininet. Parameters of the <code class="docutils literal"><span class="pre">mn</span></code> command are as follows.</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="16%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Value</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>topo</td>
<td>linear,3,2</td>
<td><p class="first">Topology where three switches are connected serially</p>
<p class="last">(Two hosts are connected to each switch)</p>
</td>
</tr>
<tr class="row-odd"><td>mac</td>
<td>None</td>
<td>Set the MAC address of the host automatically</td>
</tr>
<tr class="row-even"><td>switch</td>
<td>ovsk</td>
<td>Use Open vSwitch</td>
</tr>
<tr class="row-odd"><td>controller</td>
<td>remote</td>
<td>Use an external one for OpenFlow controller</td>
</tr>
<tr class="row-even"><td>x</td>
<td>None</td>
<td>Start the xterm</td>
</tr>
</tbody>
</table>
<p>A execution example is as follows.</p>
<div class="console highlight-python"><div class="highlight"><pre>ryu@ryu-vm:~$ sudo mn --topo linear,3,2 --mac --switch ovsk --controller remote -x
*** Creating network
*** Adding controller
Unable to contact the remote controller at 127.0.0.1:6633
*** Adding hosts:
h1s1 h1s2 h1s3 h2s1 h2s2 h2s3
*** Adding switches:
s1 s2 s3
*** Adding links:
(h1s1, s1) (h1s2, s2) (h1s3, s3) (h2s1, s1) (h2s2, s2) (h2s3, s3) (s1, s2) (s2, s3)
*** Configuring hosts
h1s1 h1s2 h1s3 h2s1 h2s2 h2s3
*** Running terms on localhost:10.0
*** Starting controller
*** Starting 3 switches
s1 s2 s3
*** Starting CLI:
mininet&gt;
</pre></div>
</div>
<p>Also, start another xterm for the controller.</p>
<div class="console highlight-python"><div class="highlight"><pre>mininet&gt; xterm c0
mininet&gt;
</pre></div>
</div>
<p>Next, set the version of OpenFlow to be used in each router to 1.3.</p>
<p>switch: s1 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ovs-vsctl set Bridge s1 protocols=OpenFlow13
</pre></div>
</div>
<p>switch: s2 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ovs-vsctl set Bridge s2 protocols=OpenFlow13
</pre></div>
</div>
<p>switch: s3 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ovs-vsctl set Bridge s3 protocols=OpenFlow13
</pre></div>
</div>
<p>Then, set the VLAN ID to the interface of each host and set the new IP address.</p>
<p>host: h1s1:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip addr del 10.0.0.1/8 dev h1s1-eth0
root@ryu-vm:~# ip link add link h1s1-eth0 name h1s1-eth0.2 type vlan id 2
root@ryu-vm:~# ip addr add 172.16.10.10/24 dev h1s1-eth0.2
root@ryu-vm:~# ip link set dev h1s1-eth0.2 up
</pre></div>
</div>
<p>host: h2s1:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip addr del 10.0.0.4/8 dev h2s1-eth0
root@ryu-vm:~# ip link add link h2s1-eth0 name h2s1-eth0.110 type vlan id 110
root@ryu-vm:~# ip addr add 172.16.10.11/24 dev h2s1-eth0.110
root@ryu-vm:~# ip link set dev h2s1-eth0.110 up
</pre></div>
</div>
<p>host: h1s2:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip addr del 10.0.0.2/8 dev h1s2-eth0
root@ryu-vm:~# ip link add link h1s2-eth0 name h1s2-eth0.2 type vlan id 2
root@ryu-vm:~# ip addr add 192.168.30.10/24 dev h1s2-eth0.2
root@ryu-vm:~# ip link set dev h1s2-eth0.2 up
</pre></div>
</div>
<p>host: h2s2:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip addr del 10.0.0.5/8 dev h2s2-eth0
root@ryu-vm:~# ip link add link h2s2-eth0 name h2s2-eth0.110 type vlan id 110
root@ryu-vm:~# ip addr add 192.168.30.11/24 dev h2s2-eth0.110
root@ryu-vm:~# ip link set dev h2s2-eth0.110 up
</pre></div>
</div>
<p>host: h1s3:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip addr del 10.0.0.3/8 dev h1s3-eth0
root@ryu-vm:~# ip link add link h1s3-eth0 name h1s3-eth0.2 type vlan id 2
root@ryu-vm:~# ip addr add 172.16.20.10/24 dev h1s3-eth0.2
root@ryu-vm:~# ip link set dev h1s3-eth0.2 up
</pre></div>
</div>
<p>host: h2s3:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip addr del 10.0.0.6/8 dev h2s3-eth0
root@ryu-vm:~# ip link add link h2s3-eth0 name h2s3-eth0.110 type vlan id 110
root@ryu-vm:~# ip addr add 172.16.20.11/24 dev h2s3-eth0.110
root@ryu-vm:~# ip link set dev h2s3-eth0.110 up
</pre></div>
</div>
<p>Finally, start rest_router on xterm of controller.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ryu-manager ryu.app.rest_router
loading app ryu.app.rest_router
loading app ryu.controller.ofp_handler
instantiating app None of DPSet
creating context dpset
creating context wsgi
instantiating app ryu.app.rest_router of RestRouterAPI
instantiating app ryu.controller.ofp_handler of OFPHandler
(2447) wsgi starting up on http://0.0.0.0:8080/
</pre></div>
</div>
<p>After a successful connection between the router and Ryu, the following message appears.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>[RT][INFO] switch_id=0000000000000003: Set SW config for TTL error packet in.
[RT][INFO] switch_id=0000000000000003: Set ARP handling (packet in) flow [cookie=0x0]
[RT][INFO] switch_id=0000000000000003: Set L2 switching (normal) flow [cookie=0x0]
[RT][INFO] switch_id=0000000000000003: Set default route (drop) flow [cookie=0x0]
[RT][INFO] switch_id=0000000000000003: Start cyclic routing table update.
[RT][INFO] switch_id=0000000000000003: Join as router.
...
</pre></div>
</div>
<p>If the above log is displayed for the three routers, preparation is complete.</p>
</div>
<div class="section" id="setting-an-address">
<h3>Setting an Address<a class="headerlink" href="#setting-an-address" title="Permalink to this headline">¶</a></h3>
<p>Set the address for each router.</p>
<p>First, set the addresses &#8220;172.16.10.1/24&#8221; and &#8220;10.10.10.1/24&#8221; to router s1. They must be set to each VLAN ID respectively.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;172.16.10.1/24&quot;}&#39; http://localhost:8080/router/0000000000000001/2
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000001&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 2,
          &quot;details&quot;: &quot;Add address [address_id=1]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;10.10.10.1/24&quot;}&#39; http://localhost:8080/router/0000000000000001/2
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000001&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 2,
          &quot;details&quot;: &quot;Add address [address_id=2]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;172.16.10.1/24&quot;}&#39; http://localhost:8080/router/0000000000000001/110
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000001&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 110,
          &quot;details&quot;: &quot;Add address [address_id=1]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;10.10.10.1/24&quot;}&#39; http://localhost:8080/router/0000000000000001/110
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000001&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 110,
          &quot;details&quot;: &quot;Add address [address_id=2]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<p>Next, set the addresses &#8220;192.168.30.1/24&#8221; and &#8220;10.10.10.2/24&#8221; to router s2.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;192.168.30.1/24&quot;}&#39; http://localhost:8080/router/0000000000000002/2
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000002&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 2,
          &quot;details&quot;: &quot;Add address [address_id=1]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;10.10.10.2/24&quot;}&#39; http://localhost:8080/router/0000000000000002/2
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000002&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 2,
          &quot;details&quot;: &quot;Add address [address_id=2]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;192.168.30.1/24&quot;}&#39; http://localhost:8080/router/0000000000000002/110
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000002&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 110,
          &quot;details&quot;: &quot;Add address [address_id=1]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;10.10.10.2/24&quot;}&#39; http://localhost:8080/router/0000000000000002/110
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000002&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 110,
          &quot;details&quot;: &quot;Add address [address_id=2]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<p>Then, set the addresses &#8220;172.16.20.1/24&#8221; and &#8220;10.10.10.3/24&#8221; to router s3.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;172.16.20.1/24&quot;}&#39; http://localhost:8080/router/0000000000000003/2
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000003&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 2,
          &quot;details&quot;: &quot;Add address [address_id=1]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;10.10.10.3/24&quot;}&#39; http://localhost:8080/router/0000000000000003/2
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000003&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 2,
          &quot;details&quot;: &quot;Add address [address_id=2]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;172.16.20.1/24&quot;}&#39; http://localhost:8080/router/0000000000000003/110
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000003&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 110,
          &quot;details&quot;: &quot;Add address [address_id=1]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;address&quot;: &quot;10.10.10.3/24&quot;}&#39; http://localhost:8080/router/0000000000000003/110
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000003&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 110,
          &quot;details&quot;: &quot;Add address [address_id=2]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<p>IP addresses to the routers have been set. Register as the default gateway on each host.</p>
<p>host: h1s1:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip route add default via 172.16.10.1
</pre></div>
</div>
<p>host: h2s1:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip route add default via 172.16.10.1
</pre></div>
</div>
<p>host: h1s2:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip route add default via 192.168.30.1
</pre></div>
</div>
<p>host: h2s2:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip route add default via 192.168.30.1
</pre></div>
</div>
<p>host: h1s3:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip route add default via 172.16.20.1
</pre></div>
</div>
<p>host: h2s3:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ip route add default via 172.16.20.1
</pre></div>
</div>
<p>The addresses that have been set are as follows.</p>
<a class="reference internal image-reference" href="_images/fig7.png"><img alt="_images/fig7.png" class="align-center" src="_images/fig7.png" style="width: 480.0px; height: 346.0px;" /></a>
</div>
<div class="section" id="setting-static-routes-and-the-default-route">
<h3>Setting Static Routes and the Default Route<a class="headerlink" href="#setting-static-routes-and-the-default-route" title="Permalink to this headline">¶</a></h3>
<p>Set static routes and the default route for each router.</p>
<p>First, set router s2 as the default route of router s1.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;gateway&quot;: &quot;10.10.10.2&quot;}&#39; http://localhost:8080/router/0000000000000001/2
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000001&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 2,
          &quot;details&quot;: &quot;Add route [route_id=1]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;gateway&quot;: &quot;10.10.10.2&quot;}&#39; http://localhost:8080/router/0000000000000001/110
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000001&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 110,
          &quot;details&quot;: &quot;Add route [route_id=1]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<p>Set router s1 as the default route of router s2.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;gateway&quot;: &quot;10.10.10.1&quot;}&#39; http://localhost:8080/router/0000000000000002/2
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000002&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 2,
          &quot;details&quot;: &quot;Add route [route_id=1]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;gateway&quot;: &quot;10.10.10.1&quot;}&#39; http://localhost:8080/router/0000000000000002/110
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000002&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 110,
          &quot;details&quot;: &quot;Add route [route_id=1]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<p>Set router s2 as default route of router s3.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;gateway&quot;: &quot;10.10.10.2&quot;}&#39; http://localhost:8080/router/0000000000000003/2
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000003&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 2,
          &quot;details&quot;: &quot;Add route [route_id=1]&quot;
        }
      ]
    }
  ]

root@ryu-vm:~# curl -X POST -d &#39;{&quot;gateway&quot;: &quot;10.10.10.2&quot;}&#39; http://localhost:8080/router/0000000000000003/110
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000003&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 110,
          &quot;details&quot;: &quot;Add route [route_id=1]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
<p>Next, for s2 router, set a static route to the host (172.16.20.0/24) under router s3. Only set if vlan_id=2.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl -X POST -d &#39;{&quot;destination&quot;: &quot;172.16.20.0/24&quot;, &quot;gateway&quot;: &quot;10.10.10.3&quot;}&#39; http://localhost:8080/router/0000000000000002/2
  [
    {
      &quot;switch_id&quot;: &quot;0000000000000002&quot;,
      &quot;command_result&quot;: [
        {
          &quot;result&quot;: &quot;success&quot;,
          &quot;vlan_id&quot;: 2,
          &quot;details&quot;: &quot;Add route [route_id=2]&quot;
        }
      ]
    }
  ]
</pre></div>
</div>
</div>
<div class="section" id="verifying-the-settings">
<h3>Verifying the Settings<a class="headerlink" href="#verifying-the-settings" title="Permalink to this headline">¶</a></h3>
<p>Check the contents of the settings for each router.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# curl http://localhost:8080/router/all/all
  [
    {
      &quot;internal_network&quot;: [
        {},
        {
          &quot;route&quot;: [
            {
              &quot;route_id&quot;: 1,
              &quot;destination&quot;: &quot;0.0.0.0/0&quot;,
              &quot;gateway&quot;: &quot;10.10.10.2&quot;
            }
          ],
          &quot;vlan_id&quot;: 2,
          &quot;address&quot;: [
            {
              &quot;address_id&quot;: 2,
              &quot;address&quot;: &quot;10.10.10.1/24&quot;
            },
            {
              &quot;address_id&quot;: 1,
              &quot;address&quot;: &quot;172.16.10.1/24&quot;
            }
          ]
        },
        {
          &quot;route&quot;: [
            {
              &quot;route_id&quot;: 1,
              &quot;destination&quot;: &quot;0.0.0.0/0&quot;,
              &quot;gateway&quot;: &quot;10.10.10.2&quot;
            }
          ],
          &quot;vlan_id&quot;: 110,
          &quot;address&quot;: [
            {
              &quot;address_id&quot;: 2,
              &quot;address&quot;: &quot;10.10.10.1/24&quot;
            },
            {
              &quot;address_id&quot;: 1,
              &quot;address&quot;: &quot;172.16.10.1/24&quot;
            }
          ]
        }
      ],
      &quot;switch_id&quot;: &quot;0000000000000001&quot;
    },
    {
      &quot;internal_network&quot;: [
        {},
        {
          &quot;route&quot;: [
            {
              &quot;route_id&quot;: 2,
              &quot;destination&quot;: &quot;172.16.20.0/24&quot;,
              &quot;gateway&quot;: &quot;10.10.10.3&quot;
            },
            {
              &quot;route_id&quot;: 1,
              &quot;destination&quot;: &quot;0.0.0.0/0&quot;,
              &quot;gateway&quot;: &quot;10.10.10.1&quot;
            }
          ],
          &quot;vlan_id&quot;: 2,
          &quot;address&quot;: [
            {
              &quot;address_id&quot;: 2,
              &quot;address&quot;: &quot;10.10.10.2/24&quot;
            },
            {
              &quot;address_id&quot;: 1,
              &quot;address&quot;: &quot;192.168.30.1/24&quot;
            }
          ]
        },
        {
          &quot;route&quot;: [
            {
              &quot;route_id&quot;: 1,
              &quot;destination&quot;: &quot;0.0.0.0/0&quot;,
              &quot;gateway&quot;: &quot;10.10.10.1&quot;
            }
          ],
          &quot;vlan_id&quot;: 110,
          &quot;address&quot;: [
            {
              &quot;address_id&quot;: 2,
              &quot;address&quot;: &quot;10.10.10.2/24&quot;
            },
            {
              &quot;address_id&quot;: 1,
              &quot;address&quot;: &quot;192.168.30.1/24&quot;
            }
          ]
        }
      ],
      &quot;switch_id&quot;: &quot;0000000000000002&quot;
    },
    {
      &quot;internal_network&quot;: [
        {},
        {
          &quot;route&quot;: [
            {
              &quot;route_id&quot;: 1,
              &quot;destination&quot;: &quot;0.0.0.0/0&quot;,
              &quot;gateway&quot;: &quot;10.10.10.2&quot;
            }
          ],
          &quot;vlan_id&quot;: 2,
          &quot;address&quot;: [
            {
              &quot;address_id&quot;: 1,
              &quot;address&quot;: &quot;172.16.20.1/24&quot;
            },
            {
              &quot;address_id&quot;: 2,
              &quot;address&quot;: &quot;10.10.10.3/24&quot;
            }
          ]
        },
        {
          &quot;route&quot;: [
            {
              &quot;route_id&quot;: 1,
              &quot;destination&quot;: &quot;0.0.0.0/0&quot;,
              &quot;gateway&quot;: &quot;10.10.10.2&quot;
            }
          ],
          &quot;vlan_id&quot;: 110,
          &quot;address&quot;: [
            {
              &quot;address_id&quot;: 1,
              &quot;address&quot;: &quot;172.16.20.1/24&quot;
            },
            {
              &quot;address_id&quot;: 2,
              &quot;address&quot;: &quot;10.10.10.3/24&quot;
            }
          ]
        }
      ],
      &quot;switch_id&quot;: &quot;0000000000000003&quot;
    }
  ]
</pre></div>
</div>
<p>A table of settings for each router is as follows.</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Router</th>
<th class="head">VLAN ID</th>
<th class="head">IP address</th>
<th class="head">Default route</th>
<th class="head">Static route</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>s1</td>
<td>2</td>
<td>172.16.10.1/24, 10.10.10.1/24</td>
<td>10.10.10.2(s2)</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>s1</td>
<td>110</td>
<td>172.16.10.1/24, 10.10.10.1/24</td>
<td>10.10.10.2(s2)</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>s2</td>
<td>2</td>
<td>192.168.30.1/24, 10.10.10.2/24</td>
<td>10.10.10.1(s1)</td>
<td><blockquote class="first last">
<div>Destination: 172.16.20.0/24, Gateway:10.10.10.3(s3)</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td>s2</td>
<td>110</td>
<td>192.168.30.1/24, 10.10.10.2/24</td>
<td>10.10.10.1(s1)</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>s3</td>
<td>2</td>
<td>172.16.20.1/24, 10.10.10.3/24</td>
<td>10.10.10.2(s2)</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>s3</td>
<td>110</td>
<td>172.16.20.1/24, 10.10.10.3/24</td>
<td>10.10.10.2(s2)</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p>Send a ping from h1s1 to h1s3. Since they&#8217;re the same host of vlan_id=2 and router 2 has a static route set to s3, it can communicate successfully.</p>
<p>host: h1s1:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ping 172.16.20.10
PING 172.16.20.10 (172.16.20.10) 56(84) bytes of data.
64 bytes from 172.16.20.10: icmp_req=1 ttl=61 time=45.9 ms
64 bytes from 172.16.20.10: icmp_req=2 ttl=61 time=0.257 ms
64 bytes from 172.16.20.10: icmp_req=3 ttl=61 time=0.059 ms
64 bytes from 172.16.20.10: icmp_req=4 ttl=61 time=0.182 ms
</pre></div>
</div>
<p>Send a ping from h2s1 to h2s3. They&#8217;re the same host of vlan_id=2 but since router s2 doesn&#8217;t have a static route set to s3, it cannot communicate successfully.</p>
<p>host: h2s1:</p>
<div class="console highlight-python"><div class="highlight"><pre>root@ryu-vm:~# ping 172.16.20.11
PING 172.16.20.11 (172.16.20.11) 56(84) bytes of data.
^C
--- 172.16.20.11 ping statistics ---
8 packets transmitted, 0 received, 100% packet loss, time 7009ms
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/fig8.png"><img alt="_images/fig8.png" class="align-center" src="_images/fig8.png" style="width: 480.0px; height: 346.0px;" /></a>
<p>In this section, you learned how to use routers with specific examples.</p>
</div>
</div>
<div class="section" id="rest-api-list">
<h2>REST API List<a class="headerlink" href="#rest-api-list" title="Permalink to this headline">¶</a></h2>
<p>A list of REST API of rest_router introduced in this section.</p>
<div class="section" id="acquiring-the-setting">
<h3>Acquiring the Setting<a class="headerlink" href="#acquiring-the-setting" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Method</strong></td>
<td>GET</td>
</tr>
<tr class="row-even"><td><strong>URL</strong></td>
<td><p class="first">/router/{<strong>switch</strong>}[/{<strong>vlan</strong>}]</p>
<p>&#8211;<strong>switch</strong>: [ &#8220;all&#8221; | <em>Switch ID</em> ]</p>
<p class="last">&#8211;<strong>vlan</strong>: [ &#8220;all&#8221; | <em>VLAN ID</em> ]</p>
</td>
</tr>
<tr class="row-odd"><td><strong>Remarks</strong></td>
<td>Specification of VLAN ID is optional.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id1">
<h3>Setting an Address<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Method</strong></td>
<td>POST</td>
</tr>
<tr class="row-even"><td><strong>URL</strong></td>
<td><p class="first">/router/{<strong>switch</strong>}[/{<strong>vlan</strong>}]</p>
<p>&#8211;<strong>switch</strong>: [ &#8220;all&#8221; | <em>Switch ID</em> ]</p>
<p class="last">&#8211;<strong>vlan</strong>: [ &#8220;all&#8221; | <em>VLAN ID</em> ]</p>
</td>
</tr>
<tr class="row-odd"><td><strong>Data</strong></td>
<td><strong>address</strong>:&#8221;&lt;xxx.xxx.xxx.xxx/xx&gt;&#8221;</td>
</tr>
<tr class="row-even"><td><strong>Remarks</strong></td>
<td><p class="first">Perform address setting before performing route setting.</p>
<p class="last">Specification of VLAN ID is optional.</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id2">
<h3>Setting Static Routes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Method</strong></td>
<td>POST</td>
</tr>
<tr class="row-even"><td><strong>URL</strong></td>
<td><p class="first">/router/{<strong>switch</strong>}[/{<strong>vlan</strong>}]</p>
<p>&#8211;<strong>switch</strong>: [ &#8220;all&#8221; | <em>Switch ID</em> ]</p>
<p class="last">&#8211;<strong>vlan</strong>: [ &#8220;all&#8221; | <em>VLAN ID</em> ]</p>
</td>
</tr>
<tr class="row-odd"><td><strong>Data</strong></td>
<td><p class="first"><strong>destination</strong>:&#8221;&lt;xxx.xxx.xxx.xxx/xx&gt;&#8221;</p>
<p class="last"><strong>gateway</strong>:&#8221;&lt;xxx.xxx.xxx.xxx&gt;&#8221;</p>
</td>
</tr>
<tr class="row-even"><td><strong>Remarks</strong></td>
<td>Specification of VLAN ID is optional.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="setting-default-route">
<h3>Setting Default Route<a class="headerlink" href="#setting-default-route" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Method</strong></td>
<td>POST</td>
</tr>
<tr class="row-even"><td><strong>URL</strong></td>
<td><p class="first">/router/{<strong>switch</strong>}[/{<strong>vlan</strong>}]</p>
<p>&#8211;<strong>switch</strong>: [ &#8220;all&#8221; | <em>Switch ID</em> ]</p>
<p class="last">&#8211;<strong>vlan</strong>: [ &#8220;all&#8221; | <em>VLAN ID</em> ]</p>
</td>
</tr>
<tr class="row-odd"><td><strong>Data</strong></td>
<td><strong>gateway</strong>:&#8221;&lt;xxx.xxx.xxx.xxx&gt;&#8221;</td>
</tr>
<tr class="row-even"><td><strong>Remarks</strong></td>
<td>Specification of VLAN ID is optional.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id3">
<h3>Deleting an Address<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Method</strong></td>
<td>DELETE</td>
</tr>
<tr class="row-even"><td><strong>URL</strong></td>
<td><p class="first">/router/{<strong>switch</strong>}[/{<strong>vlan</strong>}]</p>
<p>&#8211;<strong>switch</strong>: [ &#8220;all&#8221; | <em>Switch ID</em> ]</p>
<p class="last">&#8211;<strong>vlan</strong>: [ &#8220;all&#8221; | <em>VLAN ID</em> ]</p>
</td>
</tr>
<tr class="row-odd"><td><strong>Data</strong></td>
<td><strong>address_id</strong>:[ 1 - ... ]</td>
</tr>
<tr class="row-even"><td><strong>Remarks</strong></td>
<td>Specification of VLAN ID is optional.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="deleting-a-route">
<h3>Deleting a Route<a class="headerlink" href="#deleting-a-route" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Method</strong></td>
<td>DELETE</td>
</tr>
<tr class="row-even"><td><strong>URL</strong></td>
<td><p class="first">/router/{<strong>switch</strong>}[/{<strong>vlan</strong>}]</p>
<p>&#8211;<strong>switch</strong>: [ &#8220;all&#8221; | <em>Switch ID</em> ]</p>
<p class="last">&#8211;<strong>vlan</strong>: [ &#8220;all&#8221; | <em>VLAN ID</em> ]</p>
</td>
</tr>
<tr class="row-odd"><td><strong>Data</strong></td>
<td><strong>route_id</strong>:[ 1 - ... ]</td>
</tr>
<tr class="row-even"><td><strong>Remarks</strong></td>
<td>Specification of VLAN ID is optional.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Router</a><ul>
<li><a class="reference internal" href="#example-of-the-operation-of-a-single-tenant">Example of the Operation of a Single Tenant</a><ul>
<li><a class="reference internal" href="#building-the-environment">Building the environment</a></li>
<li><a class="reference internal" href="#setting-the-address">Setting the Address</a></li>
<li><a class="reference internal" href="#configuring-the-default-route">Configuring the Default Route</a></li>
<li><a class="reference internal" href="#setting-static-routes">Setting Static Routes</a></li>
<li><a class="reference internal" href="#verifying-the-setting">Verifying the Setting</a></li>
<li><a class="reference internal" href="#deleting-the-static-route">Deleting the Static Route</a></li>
<li><a class="reference internal" href="#deleting-an-address">Deleting an Address</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-of-the-operation-of-a-multi-tenant">Example of the Operation of a Multi-tenant</a><ul>
<li><a class="reference internal" href="#environment-building">Environment building</a></li>
<li><a class="reference internal" href="#setting-an-address">Setting an Address</a></li>
<li><a class="reference internal" href="#setting-static-routes-and-the-default-route">Setting Static Routes and the Default Route</a></li>
<li><a class="reference internal" href="#verifying-the-settings">Verifying the Settings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rest-api-list">REST API List</a><ul>
<li><a class="reference internal" href="#acquiring-the-setting">Acquiring the Setting</a></li>
<li><a class="reference internal" href="#id1">Setting an Address</a></li>
<li><a class="reference internal" href="#id2">Setting Static Routes</a></li>
<li><a class="reference internal" href="#setting-default-route">Setting Default Route</a></li>
<li><a class="reference internal" href="#id3">Deleting an Address</a></li>
<li><a class="reference internal" href="#deleting-a-route">Deleting a Route</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="rest_firewall.html"
                        title="previous chapter">Firewall</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="rest_qos.html"
                        title="next chapter">QoS</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/rest_router.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="rest_qos.html" title="QoS"
             >next</a> |</li>
        <li class="right" >
          <a href="rest_firewall.html" title="Firewall"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Ryubook 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, RYU project team.
    </div>
  </body>
</html>